<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RU Examination System</title>
    <link rel="stylesheet" href="/static/css/css_admin/view_student_detail_style.css">
    <style>
    </style>
</head>
<body>
    <div class="main_page_of_loginpage">
        <div class="main_header_loginpage">
            <div class="loginpage_header_rusys">
                <img id="ru_logo" src="/static/img/logo.png" alt="main_ru_logo">
                <h2>
                    <b>ରେଭେନ୍ସା ବିଶ୍ଵବିଦ୍ୟାଳୟ ମହାନଦୀ କ୍ୟାମ୍ପସ<br>
                    RAVENSHAW UNIVERSITY <br>MAHANADI CAMPUS<br>
                    <i>"The Temple of Knowledge"</i></b>
                </h2>
            </div>
            <div class="loginpage_title_center" id="title_holder_loginpage">
                <h1>RU EXAMINATION SYSTEM</h1>
            </div>
            <div class="edu_logo">
                <img id="edu_logo" src="/static/img/edulogo.png" alt="he_logo">
            </div>
        </div>
        <hr id="login_webpage_divider">
    </div>
    <div class="time-date-container">
        <p id="currentDate">Loading date...</p>
        <p id="currentTime">Loading time...</p>
    </div>
    {% if user.is_authenticated %}
    {% for a in admin_student_dada_feltred %}
    <div class="student-detail-container">
        <div class="name_of_header">VIEW DETAIL OF STUDENT</div>
        <table>
            <thead>
                <tr id="table_header">
                    <th id="table_field_data">Field</th>
                    <th id="table_details_data">Details</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td id="table_field_data_1">Student ID/Roll_no</td>
                    <td id="table_details_data_1">{{a.Student_info_add_student_exam_rollnumber | upper}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_2">First Name</td>
                    <td id="table_details_data_2">{{a.Student_info_add_student_f_name|upper}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_3">Last Name</td>
                    <td id="table_details_data_3">{{a.Student_info_add_student_l_name|upper}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_4">Father's Name</td>
                    <td id="table_details_data_4">{{a.Student_info_add_student_father_name|upper}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_5">Mother's Name</td>
                    <td id="table_details_data_5">{{a.Student_info_add_student_mother_name}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_6">Serial No</td>
                    <td id="table_details_data_6">{{a.Student_info_add_student_serial_number}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_7">Gender</td>
                    <td id="table_details_data_7">{{a.Student_info_add_student_gender}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_8">Email</td>
                    <td id="table_details_data_8">{{a.Student_info_add_student_email}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_9">Date of Birth</td>
                    <td id="table_details_data_9">{{a.Student_info_add_student_DoB}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_10">Contact No</td>
                    <td id="table_details_data_10">{{a.Student_info_add_student_phoneno}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_11">Address</td>
                    <td id="table_details_data_11">{{a.Student_info_add_student_adress}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_12">Category</td>
                    <td id="table_details_data_12">{{a.Student_info_add_student_categori}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_13">Disability Status</td>
                    <td id="table_details_data_13">{{a.Student_info_add_student_Disable_status}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_14">Password</td>
                    <td id="table_details_data_14">{{a.Student_info_add_student_password}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_15">Department</td>
                    <td id="table_details_data_15">{{a.Student_info_add_student_department}}</td>
                </tr>
                <tr>
                    <td id="table_field_data_16">Branch</td>
                    <td id="table_details_data_16">{{a.Student_info_add_student_branch}}</td>
                </tr>
                <!--<tr>
                    <td id="table_field_data_17">Year of Study</td>
                    <td id="table_details_data_17">3</td>
                </tr>-->
                <!--<tr>
                    <td id="table_field_data_18">Exam Type</td>
                    <td id="table_details_data_18">Regular</td>
                </tr>-->
                <tr>
                    <td id="table_field_data_19">Uploaded Photo</td>
                    <td id="table_details_data_19"><img src="{{a.Student_info_add_student_photo.url }}" alt="Photo" width="50"></td>
                </tr>
                <tr>
                    <td id="table_field_data_20">Uploaded Signature</td>
                    <td id="table_details_data_20"><img src="{{a.Student_info_add_student_sign.url }}" alt="Signature" width="50"></td>
                </tr>
                <tr>
                    <td id="table_field_data_21">Uploaded ID Proof</td>
                    <td id="table_details_data_21">
                        <a href="{{ a.Student_info_add_student_idproof.url }}" download>
                            <button class="download-btn">Download ID Proof</button>
                        </a>
                    </td>
                </tr>
            </tbody>
        </table>
        
        <button class="download-btn" onclick="downloadPDF()">Download PDF</button>
    </div>
    {%endfor %}
    {% endif %}
    <div class="footer" id="footer_admin_pannel">
        © <span id="currentYear"></span> Ravenshaw University. All Rights Reserved.
    </div>
    <script>
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        // Function to update the current time and date
        function updateTimeAndDate() {
            const now = new Date();

            // Format the date
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const formattedDate = now.toLocaleDateString('en-US', options);

            // Format the time
            const formattedTime = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

            // Update the HTML elements
            document.getElementById('currentDate').textContent = formattedDate;
            document.getElementById('currentTime').textContent = formattedTime;
        }

        // Update the time and date every second
        setInterval(updateTimeAndDate, 1000);

        // Initial call to display the time and date immediately
        updateTimeAndDate();
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <script>
        async function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
    
            const pageHeight = doc.internal.pageSize.height; // Get the page height
            let currentY = 20; // Start position for content
    
            // Add title
            doc.setFontSize(18);
            doc.text("Student Details", 105, currentY, { align: "center" });
            currentY += 20;
    
            // Add photo at the top
            const photoElement = document.querySelector('td img[alt="Photo"]');
            if (photoElement) {
                const photoSrc = photoElement.src;
                const photoBlob = await fetch(photoSrc).then(res => res.blob());
                const photoURL = URL.createObjectURL(photoBlob);
                doc.addImage(photoURL, "PNG", 85, currentY, 40, 40); // Center the image
                currentY += 50;
            }
    
            // Add table data
            const fields = [
                { label: "Student ID", id: "table_details_data_1" },
                { label: "First Name", id: "table_details_data_2" },
                { label: "Last Name", id: "table_details_data_3" },
                { label: "Father's Name", id: "table_details_data_4" },
                { label: "Mother's Name", id: "table_details_data_5" },
                { label: "Roll No", id: "table_details_data_6" },
                { label: "Gender", id: "table_details_data_7" },
                { label: "Email", id: "table_details_data_8" },
                { label: "Date of Birth", id: "table_details_data_9" },
                { label: "Contact No", id: "table_details_data_10" },
                { label: "Address", id: "table_details_data_11" },
                { label: "Category", id: "table_details_data_12" },
                { label: "Disability Status", id: "table_details_data_13" },
                { label: "Password", id: "table_details_data_14" },
                { label: "Department", id: "table_details_data_15" },
                { label: "Branch", id: "table_details_data_16" },
                { label: "Year of Study", id: "table_details_data_17" },
                { label: "Exam Type", id: "table_details_data_18" }
            ];
    
            doc.setFontSize(12);
            for (const field of fields) {
                if (currentY + 10 > pageHeight) {
                    doc.addPage(); // Add a new page if content exceeds the page height
                    currentY = 20; // Reset Y position for the new page
                }
                const detailElement = document.getElementById(field.id);
                const detailText = detailElement ? detailElement.textContent : "N/A";
                doc.text(field.label, 20, currentY);
                doc.text(detailText, 80, currentY);
                currentY += 10;
            }
    
            // Add uploaded documents at the end
            if (currentY + 50 > pageHeight) {
                doc.addPage();
                currentY = 20;
            }
            doc.setFontSize(14);
            doc.text("Uploaded Documents", 20, currentY);
            currentY += 10;
    
            const uploadedDocs = [
                { label: " ", selector: 'td img[alt="ID Proof"]', type: 'pdf' }
            ];
    
            for (const docItem of uploadedDocs) {
                if (currentY + 50 > pageHeight) {
                    doc.addPage();
                    currentY = 20;
                }
    
                const element = document.querySelector(docItem.selector);
                if (element) {
                    const fileSrc = element.src;
    
                    if (docItem.type === 'pdf') {
                        // Add a link to the PDF in the generated document
                        doc.text(docItem.label, 20, currentY);
                        doc.setTextColor(0, 0, 255); // Set text color to blue for the link
                        doc.textWithLink('View PDF', 80, currentY, { url: fileSrc });
                        doc.setTextColor(0, 0, 0); // Reset text color to black
                        currentY += 10;
                    } else {
                        // Handle images (e.g., photos or signatures)
                        const imgBlob = await fetch(fileSrc).then(res => res.blob());
                        const imgURL = URL.createObjectURL(imgBlob);
                        doc.text(docItem.label, 20, currentY);
                        doc.addImage(imgURL, "PNG", 80, currentY - 10, 40, 40); // Add image next to label
                        currentY += 50;
                    }
                }
            }
    
            // Add declaration and signature section
            if (currentY + 30 > pageHeight) {
                doc.addPage();
                currentY = 20;
            }
            doc.setFontSize(12);
            doc.text("Declaration:", 20, currentY);
            currentY += 10;
            doc.text(
                "I hereby declare that the above information is true to the best of my knowledge and belief.",
                20,
                currentY
            );
            currentY += 20;
    
            // Add uploaded signature
            const signatureElement = document.querySelector('td img[alt="Signature"]');
            if (signatureElement) {
                const signatureSrc = signatureElement.src;
                const signatureBlob = await fetch(signatureSrc).then(res => res.blob());
                const signatureURL = URL.createObjectURL(signatureBlob);
                doc.text("Signature:", 20, currentY);
                doc.addImage(signatureURL, "PNG", 80, currentY - 10, 40, 40); // Add the signature image
                currentY += 50;
            }
    
            // Get the filename from the Student ID field
        const studentIdElement = document.getElementById("table_details_data_1");
        const studentId = studentIdElement ? studentIdElement.textContent.trim() : "Student_Details";

        // Save the PDF with the Student ID as the filename
        doc.save(`${studentId}.pdf`);

        // Show success message
        alert("PDF downloaded successfully!");
    }
    </script>
</body>
</html>